---
name: test

on:
    - push

jobs:
    test:
        runs-on: ubuntu-latest
        name: Test Dockerless Install
        strategy:
            matrix:
                perl-version:
                    - "5.22"
                    - "5.24"
                    - "5.26"
                    - "5.28"
                    - "5.30"
        container:
            image: perl:${{ matrix.perl-version }}
            env:
                CPAN_RESOLVER: snapshot
                DEPLOYMENT_PERL_VERSION: 5.22
                DEVEL_COVER_OPTIONS: "-ignore,^local/"
        steps:
            - uses: actions/checkout@v1
            - uses: actions/setup-node@v1
              with:
                  node-version: "12"
            - run: npm install -g yarn && yarn install
            - name: Install Carton
              run: curl -sL https://git.io/cpm | perl - install -g Carton --show-build-log-on-failure
            - name: Install deps
              run: curl -sL https://git.io/cpm | perl - install --cpanfile cpanfile --show-build-log-on-failure
              if: success()
            - name: Run Tests
              run: carton exec prove -lr --jobs 2 t
              if: success()
